#第2章　グローバルインフラストラクチャとネットワーク

##2-1 リージョンとアベイラビリティゾーン
- リージョンとは？
  - AWSがサービスを提供している拠点(国と地域)のことを指す
  - リージョン内には複数のアベイラビリティゾーン（AZ）が含まれ、1つのAZは複数のデータセンターから構成される
  - 複数のデータセンターがAZを構成し、複数のAZが集まったものがリージョンとなる

- AZの地理的・電源的独立による信頼性の向上
  - 地理的独立
    - それぞれのAZは、地理的・電源的に独立された場所に配置される
    - 地理的な独立により、災害によるAZのへの局所的な障害に対して、別のAZが影響されないように配置されている
    - AZ間は数十キロ程度離れて配置されているようだが、各AZ間は高速なネットワーク回線で接続されている
    - そのため、ネットワーク遅延の問題が発生することはほとんどなく、AZ間のネットワーク遅延(レイテンシー)は、2ミリ秒以下で安定していることが多い
  - 電源的独立
    - 電源の系統の分離のことで、1ヶ所の停電によりAZ内のすべてのデータセンターが一斉にダウンすることがないように設計されている
  - AZの地理的・電源的独立により、リージョン全体で見たときに、AWSは障害への耐久性が高くなり信頼性が高いと言える

- マルチAZによる可用性の向上
  - 耐障害性を高めシステムの可用性を高めるには、複数のAZを利用してシステムを構築する必要がある
  - AWSでは、これをマルチAZと呼ぶ
  - EC2といった仮想サーバーやデータベースサービスであるRDSなど、インスタンスをベースとしたサービスは、可用性を高める際はマルチAZに冗長的に配置するのが基本

##2-2 VPC
- AWSのネットワークサービスの中心はAmazon Virtual Private Cloud(VPC)
- 利用者ごとのプライベートなネットワークをAWS内に作成する
- インターネットゲートウェイ(IGW)と呼ばれるインターネット側の出口をつけることにより、直接インターネットに出ていくことができる
- オンプレミスの各拠点を繋げるために仮想プライベートゲートウェイ(VGW)を出口として、専用線のサービスであるDirect ConnectやVPN経由で直接的にインターネットに出ずに、各拠点と接続も可能

## IPアドレス
- VPCには、作成が自由なIPアドレス(CIDRブロック)をアサインすることができる
- CIDRブロックは/16から/28の範囲で作成できる
- ネットワーク空間は可能な限り大きなサイズ(/16)で作成すること(後から拡張する方法はあるが、難しいため)
- IPアドレスとしては、クラスA(10.0.0.0 ~ 10.255.255.255)、クラスB(172.16.0.0 ~ 172.31.255.255)、クラスC(192.168.0.0 ~ 192.168.255.255)が使える
- クラスAの場合でも、/8でCIDRブロックは取ることができず、/16でなければならない

## サブネット
- サブネットとは？
  - EC2インスタンスなどを起動するための、VPC内部に作るアドレスレンジ
  - 個々のサブネットには1つの仮想のルーターがあり、このルーターがルートテーブルとネットワークACLの設定を持ち、サブネット内のEC2インスタンスのデフォルトゲートウェイになる
  - サブネットに設定するCIDRブロックのサイズはVPCと同様に16ビット(65536個)から28ビット(16個)まで
  - サブネット作成時にアベイラビリティゾーンを指定する、作成後は変更できない
  - サブネットごとにルートテーブルを1つだけ指定する(作成時はメインルートテーブルが自動的にアサインされ、いつでも異なるルートテーブルに変更可能)
  - サブネットごとにネットワークACLを1つだけ指定する(作成時はデフォルトネットワークACLが自動的にアサインされ、いつでも異なるネットワークACLに変更可能)
  - 1つのVPCに作れるサブネットの数は200個。リクエストにより、拡張可能
- サブネット作成の注意事項
  - サブネットの最初の4つおよび最後の1つのアドレスは予約されていて、使用できない(24ビットマスクのサブネットの場合「0,1,2,3,255」の5つ)
  - 必要以上にサブネットで分割することはアドレスの浪費に繋がる
  - サービスの中にはIPアドレスの確保が必要なサービスがある(ELBの場合はIPアドレスが8個)
  